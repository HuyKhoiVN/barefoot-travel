@{
    ViewData["Title"] = "Tour Status Approval";
    Layout = "~/Views/Admin/_Layout.cshtml";
}

@await Html.PartialAsync("~/Views/Admin/_AdminCurrencyStyles.cshtml")
<link rel="stylesheet" href="~/css/tour-approval.css" asp-append-version="true" />

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="d-md-flex align-items-center justify-content-between">
                    <div>
                        <h4 class="card-title">Tour Status Approval</h4>
                        <p class="card-subtitle">Manage tour status and approval workflow</p>
                    </div>
                </div>
                
                <!-- Status Filter Tabs -->
                <ul class="nav nav-pills mb-4 mt-4" role="tablist" id="statusTabs">
                    <li class="nav-item">
                        <button class="nav-link active" data-status="">
                            All Tours <span class="badge bg-secondary" id="badge-all">0</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-status="draft">
                            Draft <span class="badge bg-info" id="badge-draft">0</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-status="public">
                            Public <span class="badge bg-success" id="badge-public">0</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-status="hide">
                            Hidden <span class="badge bg-warning" id="badge-hide">0</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-status="cancelled">
                            Cancelled <span class="badge bg-danger" id="badge-cancelled">0</span>
                        </button>
                    </li>
                </ul>

                <!-- View Toggle and Search -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-secondary active" id="viewTable">
                            <i class="ti ti-table"></i> Table
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="viewCards">
                            <i class="ti ti-layout-grid"></i> Cards
                        </button>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <input type="text" class="form-control form-control-sm" id="searchInput" 
                               placeholder="Search tours..." style="width: 250px;">
                        <button class="btn btn-sm btn-outline-secondary" id="btnClearSearch">
                            <i class="ti ti-x"></i>
                        </button>
                    </div>
                </div>

                <!-- Loading Indicator -->
                <div id="loadingIndicator" class="text-center my-4" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>

                <!-- Table View -->
                <div class="table-responsive" id="tableView">
                    <table class="table table-hover align-middle mb-0">
                        <thead>
                            <tr>
                                <th style="width: 40px;">
                                    <input type="checkbox" class="form-check-input" id="selectAll">
                                </th>
                                <th style="width: 80px;">Image</th>
                                <th>Title</th>
                                <th style="width: 120px;">Status</th>
                                <th style="width: 100px;">Price</th>
                                <th style="width: 100px;">Duration</th>
                                <th style="width: 120px;">Created</th>
                                <th style="width: 165px;" class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="toursTableBody">
                            <!-- Rows will be inserted dynamically -->
                        </tbody>
                    </table>
                </div>

                <!-- Card View -->
                <div class="row" id="cardView" style="display: none;">
                    <!-- Cards will be inserted dynamically -->
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="text-center py-5" style="display: none;">
                    <i class="ti ti-inbox fs-1 text-muted mb-3"></i>
                    <p class="text-muted">No tours found</p>
                </div>

                <!-- Pagination -->
                <nav aria-label="Tours pagination" class="mt-4" id="paginationContainer">
                    <ul class="pagination justify-content-center" id="pagination">
                        <!-- Pagination will be generated here -->
                    </ul>
                </nav>
            </div>
        </div>

        <!-- Workflow Process Section -->
        <div class="card mt-4 shadow-sm" style="border: 2px dashed #e0e0e0;">
            <div class="card-body">
                <h6 class="card-title mb-3">
                    <i class="ti ti-arrow-right-circle me-2"></i>Drag Tours Here to Change Status
                </h6>
                
                <div class="d-flex justify-content-around align-items-center workflow-container flex-wrap">
                    <!-- Draft Zone -->
                    <div class="workflow-zone p-4 rounded-3 text-center" data-target-status="draft" 
                         style="flex: 1; min-width: 200px; background: #e8f5e9; border: 2px solid #4caf50; min-height: 120px; margin: 0.5rem;">
                        <i class="ti ti-file-text fs-1 text-success mb-2"></i>
                        <h6 class="text-success mb-1">Draft</h6>
                        <small class="text-muted">Initial status</small>
                        <div class="drop-indicator mt-2" style="display: none;">
                            <i class="ti ti-download"></i> Drop here
                        </div>
                    </div>
                    
                    <div class="mx-2 d-none d-lg-block">
                        <i class="ti ti-arrow-right fs-4 text-muted"></i>
                    </div>
                    
                    <!-- Public Zone -->
                    <div class="workflow-zone p-4 rounded-3 text-center" data-target-status="public" 
                         style="flex: 1; min-width: 200px; background: #e3f2fd; border: 2px solid #2196f3; min-height: 120px; margin: 0.5rem;">
                        <i class="ti ti-world fs-1 text-primary mb-2"></i>
                        <h6 class="text-primary mb-1">Public</h6>
                        <small class="text-muted">Visible to users</small>
                        <div class="drop-indicator mt-2" style="display: none;">
                            <i class="ti ti-download"></i> Drop here
                        </div>
                    </div>
                    
                    <div class="mx-2 d-none d-lg-block">
                        <i class="ti ti-arrow-right fs-4 text-muted"></i>
                    </div>
                    
                    <!-- Hide Zone -->
                    <div class="workflow-zone p-4 rounded-3 text-center" data-target-status="hide" 
                         style="flex: 1; min-width: 200px; background: #fff3e0; border: 2px solid #ff9800; min-height: 120px; margin: 0.5rem;">
                        <i class="ti ti-eye-off fs-1 text-warning mb-2"></i>
                        <h6 class="text-warning mb-1">Hidden</h6>
                        <small class="text-muted">Not visible</small>
                        <div class="drop-indicator mt-2" style="display: none;">
                            <i class="ti ti-download"></i> Drop here
                        </div>
                    </div>
                    
                    <div class="mx-2 d-none d-lg-block">
                        <i class="ti ti-arrow-right fs-4 text-muted"></i>
                    </div>
                    
                    <!-- Cancelled Zone -->
                    <div class="workflow-zone p-4 rounded-3 text-center" data-target-status="cancelled" 
                         style="flex: 1; min-width: 200px; background: #ffebee; border: 2px solid #f44336; min-height: 120px; margin: 0.5rem;">
                        <i class="ti ti-ban fs-1 text-danger mb-2"></i>
                        <h6 class="text-danger mb-1">Cancelled</h6>
                        <small class="text-muted">Terminated</small>
                        <div class="drop-indicator mt-2" style="display: none;">
                            <i class="ti ti-download"></i> Drop here
                        </div>
                    </div>
                </div>
                
                <!-- Batch Actions -->
                <div class="mt-4 text-center" id="batchActionsSection" style="display: none;">
                    <div class="alert alert-info d-inline-flex align-items-center mb-3">
                        <i class="ti ti-info-circle me-2"></i>
                        <span id="selectedCount">0</span> tour(s) selected
                        <span id="selectedStatusInfo" class="ms-2"></span>
                    </div>
                    <div class="d-flex justify-content-center gap-2 flex-wrap" id="batchActionsButtons">
                        <button class="btn btn-sm btn-success" id="btnBatchPublic" onclick="batchChangeStatus('public')" 
                                data-bs-toggle="tooltip" title="Make tours public">
                            <i class="ti ti-check me-1"></i>Approve to Public
                        </button>
                        <button class="btn btn-sm btn-warning" id="btnBatchHide" onclick="batchChangeStatus('hide')"
                                data-bs-toggle="tooltip" title="Hide tours from users">
                            <i class="ti ti-eye-off me-1"></i>Hide
                        </button>
                        <button class="btn btn-sm btn-danger" id="btnBatchCancelled" onclick="batchChangeStatus('cancelled')"
                                data-bs-toggle="tooltip" title="Cancel tours">
                            <i class="ti ti-ban me-1"></i>Cancel
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="batchDelete()"
                                data-bs-toggle="tooltip" title="Soft delete tours">
                            <i class="ti ti-trash me-1"></i>Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tour Detail Modal -->
<div class="modal fade" id="tourDetailModal" tabindex="-1" aria-labelledby="tourDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="tourDetailModalLabel">Tour Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="tourDetailContent">
                <!-- Content will be loaded dynamically -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Status History Modal -->
<div class="modal fade" id="statusHistoryModal" tabindex="-1" aria-labelledby="statusHistoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="statusHistoryModalLabel">Status Change History</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="statusHistoryContent">
                <!-- Content will be loaded dynamically -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/toast.js" asp-append-version="true"></script>
    <script src="~/js/tour-approval.js" asp-append-version="true"></script>
}

